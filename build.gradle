apply plugin: 'java'

repositories {
    mavenLocal()
    mavenCentral()
}

sourceCompatibility = '11'
targetCompatibility = '11'

dependencies {
    implementation 'org.pzdcdoc:pzdcdoc:2.3'
}

defaultTasks 'clean', 'buildDoc'

task buildDoc(type:JavaExec) {
    classpath = sourceSets.main.runtimeClasspath
    main = 'org.pzdcdoc.Generator'
    args '--in', 'src', '--out', 'target/doc'
}

// bash -c "./gradlew publishDoc -Ppublish.login=user@host -Ppublish.folder=/home/path"
task publishDoc(dependsOn: 'buildDoc') {
    doFirst {
        def sshLogin = findProperty("publish.login");
        def sshFolder = findProperty("publish.folder")

        def branchName = 'git rev-parse --abbrev-ref HEAD'.execute().text.trim()
        println "Branch name: $branchName"

        def command = "rsync --delete -Pav target/doc/ $sshLogin:$sshFolder"

        println "Running: $command"
        println command.execute().text
    }
}